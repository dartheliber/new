--TABLA TOTAL PLAY DESARROLLO--
CREATE TABLE CECO.TACCNE26_TOTALPLAY
(
  FDFECHAPROCESO       DATE                     NOT NULL,
  FIANIO               NUMBER(4)                NOT NULL,
  FISEMANA             NUMBER(2)                NOT NULL,
  FCNCTROCTOSUC        VARCHAR2(15 BYTE)        NOT NULL,
  FINSUCURSALCVE       NUMBER(5),
  FCNOMBRE             VARCHAR2(100 BYTE)       NOT NULL,
  FISTATUS             VARCHAR2(15 CHAR)        NOT NULL,
  FIIDENTIDAD          NUMBER(4)                NOT NULL,
  FCNOMBREENTIDAD      VARCHAR2(100 BYTE)       NOT NULL,
  FICFORMATOU          NUMBER(3)                NOT NULL,
  FDFECHAPACT          DATE,
  FDFECHACIERRE        DATE,
  FCCOLOR              VARCHAR2(2 BYTE)         NOT NULL,
  FINEGOCIOID          NUMBER(3)                NOT NULL,
  FCNEGOCIO            VARCHAR2(50 BYTE)        NOT NULL,
  FIGASTOID            NUMBER(4)                NOT NULL,
  FCGASTOID            VARCHAR2(100 BYTE)       NOT NULL,
  FIPLAZACIUDAD        NUMBER(4),
  FCPLAZACIUDAD        VARCHAR2(100 BYTE),
  ULTIMA_MODIFICACION  DATE                     NOT NULL,
  USUARIO_MODIFICO     VARCHAR2(30 BYTE)        NOT NULL
)
TABLESPACE CECO_TEMP01_DAT
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOLOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;


CREATE UNIQUE INDEX PK_TACCNE26 ON CECO.TACCNE26_TOTALPLAY
(FIANIO, FISEMANA, FCNCTROCTOSUC, FIIDENTIDAD)
NOLOGGING
TABLESPACE CECO_TEMP01_DAT
PCTFREE    10
INITRANS   2
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOPARALLEL;


ALTER TABLE CECO.TACCNE26_TOTALPLAY ADD (
  CONSTRAINT PK_TACCNE26
  PRIMARY KEY
  (FIANIO, FISEMANA, FCNCTROCTOSUC, FIIDENTIDAD)
  USING INDEX PK_TACCNE26);

  
--QUERY PARA CARGAR DATOS DE TOTAL PLAY A DESARROLLO--
--PASO 1: CREAR TABLA TEMPORAL PARA ALMACENAR LOS CODIFOS Y DESCRIPCIONES DE VICEPRESIDENCIA
--UNIR POR MEDIO DE FCNCTROCTOSUC CON LAS TABLAS DE BANDERA
CREATE TABLE CECO.TESTPRESD1 (
  FCNCTROCTOSUC           VARCHAR2(15 BYTE)     NOT NULL,
  FIIDENTIDAD             NUMBER(4)             NOT NULL,
  FCNOMBRE                VARCHAR2(100)         NOT NULL,
  FDFECHAPACT             DATE,
  FIVICEPRESIDENCIAID     NUMBER(3)             NOT NULL,
  FCVICEPRESIDENCIA       VARCHAR2(50 BYTE)     NOT NULL
  )
TABLESPACE CECO_TEMP01_DAT
PCTUSED    0
PCTFREE    10
INITRANS   1
MAXTRANS   255
STORAGE    (
            INITIAL          64K
            NEXT             1M
            MINEXTENTS       1
            MAXEXTENTS       UNLIMITED
            PCTINCREASE      0
            BUFFER_POOL      DEFAULT
           )
NOLOGGING 
NOCOMPRESS 
NOCACHE
NOPARALLEL
MONITORING;

--PASO 2: CARGAR LOS DATOS OBTENIDOS DE PROD A LA TABLA TEMPORAL DE TOTAL PLAY POR MEDIO DE UN ARCHIVO
--SE PUEDE USAR LA HERRAMIENTA IMPORT TABLE DATA DE TOAD

--PASO 3: UNIR CON LAS TABLAS DE BANDERA Y EL RESULTADO EXPORTARLO A UN ARCHIVO
SELECT PRI.FDFECHAPROCESO, 
       PRI.FIANIO, 
       PRI.FISEMANA, 
       EST.FICCID_HIJO, 
       PRI.FINSUCURSALCVE, 
       PRI.FCNOMBRE, 
       PRI.FISTATUS, 
       PRI.FIIDENTIDAD, 
       PRI.FCNOMBREENTIDAD, 
       PRI.FICFORMATOU, 
       PRI.FDFECHAPACT, 
       PRI.FDFECHACIERRE, 
       PRI.FCCOLOR, 
       PRES.FIVICEPRESIDENCIAID AS FINEGOCIOID,
       PRES.FCVICEPRESIDENCIA AS FCNEGOCIO,
       SEC.FIIDEXT1 AS FIGASTOID,
       SEC.FCEXT1 AS FCGASTOID,
       SEC.FIIDGASTOPROD AS FIPLAZACIUDAD,
       SEC.FCGASTOPROD AS FCPLAZACIUDAD,
       SYSDATE AS ULTIMA_MODIFICACION,
       SYSDATE AS ULTIMA_MODIFICACION,
       'CECO' AS USUARIO_MODIFICO 

FROM CECO.TACCBA037_UNEST EST

JOIN CECO.TACCBA035_UNPRI PRI
  ON (PRI.FCNCTROCTOSUC = EST.FICCID_HIJO
 AND PRI.FIIDENTIDAD    = EST.FIENTIDADID_HIJO )

JOIN CECO.TACCBA036_UNSEC SEC
  ON (PRI.FCNCTROCTOSUC = SEC.FCNCTROCTOSUC
 AND PRI.FIIDENTIDAD    = SEC.FIIDENTIDAD )                                           

JOIN CECO.TESTPRESD1 PRES
  ON (PRI.FCNCTROCTOSUC = PRES.FCNCTROCTOSUC
 AND PRI.FIIDENTIDAD    = PRES.FIIDENTIDAD )     

WHERE EST.FISEMANA         = 42
  AND PRI.FDFECHAPROCESO   = TO_DATE('18/10/2016', 'DD/MM/YYYY')
  AND SEC.FDFECHAPROCESO   = TO_DATE('18/10/2016', 'DD/MM/YYYY')
  AND EST.FIESTRUCTURA     = 15
  AND EST.FIENTIDADID_HIJO = 13;

--PASO 4: CARGAR A LA TABLA CREADA PARA TOTAL PLAY LOS DATOS OBTENIDOS EN EL ARCHIVO GENERADO EN EL PASO 3
--SE PUEDE HACER CON LA HERRAMIENTA IMPORT TABLE DATA
